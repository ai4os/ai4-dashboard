<mat-toolbar class="mb-3">
    <ng-container *ngIf="!isTool; else toolTitleText">
        <span class="aligned-with-icon">
            {{ 'MODULES.MODULE-DETAIL.TITLE' | translate }}
            <mat-icon>view_in_ar</mat-icon>
        </span>
    </ng-container>
    <ng-template #toolTitleText>
        <span class="aligned-with-icon">
            {{ 'MODULES.MODULE-DETAIL.TOOL-TITLE' | translate }}
            <mat-icon>view_in_ar</mat-icon>
        </span>
    </ng-template>
</mat-toolbar>

<xng-breadcrumb class="mb-3"></xng-breadcrumb>

<mat-card class="detail-card">
    <mat-card-header
        *ngIf="!isLoading"
        [ngClass]="{
            'module-detail-card-header-mobile': mobileQuery.matches,
            'module-detail-card-header': !mobileQuery.matches
        }"
    >
        <mat-card-title
            ><h1>{{ module.title }}</h1></mat-card-title
        >
        <mat-card-subtitle>{{ module.summary }}</mat-card-subtitle>

        <div
            *ngIf="!isTool"
            [ngClass]="{
                'action-buttons-container-mobile': mobileQuery.matches,
                'action-buttons-container': !mobileQuery.matches
            }"
        >
            <div
                class="tooltip-container"
                [matTooltipDisabled]="isLoggedIn()"
                matTooltip=" {{
                    'MODULES.MODULE-DETAIL.TRY-MODULE-LOGOUT' | translate
                }}"
            >
                <a
                    class="action-button"
                    [matMenuTriggerFor]="tryMenu"
                    mat-raised-button
                    color="accent"
                    [disabled]="!isLoggedIn()"
                >
                    {{ 'MODULES.MODULE-DETAIL.TRY-MODULE' | translate }}

                    <mat-icon class="arrow-button">
                        keyboard_arrow_down
                    </mat-icon>
                </a>
            </div>

            <mat-menu #tryMenu="matMenu" xPosition="before">
                <button mat-menu-item (click)="createGradioDeployment()">
                    <span class="button-with-icon">
                        <img
                            src="../../../../../assets/images/gradio-logo.png"
                            width="24"
                            height="24"
                        />
                        <div class="button-texts">
                            <b>
                                {{
                                    'MODULES.MODULE-DETAIL.USER-INTERFACE'
                                        | translate
                                }}</b
                            >
                            <span class="button-description-text">
                                {{
                                    'MODULES.MODULE-DETAIL.NOMAD-GRADIO'
                                        | translate
                                }}</span
                            >
                        </div>
                    </span>
                </button>
                <button mat-menu-item [disabled]="true" style="display: none">
                    <span class="button-with-icon">
                        <img
                            src="../../../../../assets/images/swagger-logo.svg"
                            width="24"
                            height="24"
                        />
                        <div class="button-texts">
                            <b>
                                {{
                                    'MODULES.MODULE-DETAIL.INFERENCE-API'
                                        | translate
                                }}</b
                            >
                            <span class="button-description-text">{{
                                'MODULES.MODULE-DETAIL.OSCAR-SWAGGER'
                                    | translate
                            }}</span>
                        </div>
                    </span>
                </button>
            </mat-menu>

            <ng-container *ngIf="isLoggedIn() && isAuthorized()">
                <a
                    class="action-button"
                    [matMenuTriggerFor]="deployMenu"
                    mat-raised-button
                    color="accent"
                >
                    {{ 'MODULES.MODULE-DETAIL.DEPLOY-MODULE' | translate }}

                    <mat-icon class="arrow-button">
                        keyboard_arrow_down
                    </mat-icon>
                </a>

                <mat-menu #deployMenu="matMenu" xPosition="before">
                    <button
                        style="display: none"
                        class="action-button sub-button"
                        mat-menu-item
                        (click)="createOscarService()"
                    >
                        <span class="button-with-icon">
                            <img
                                src="../../../../../assets/images/oscar-logo.png"
                                width="24"
                                height="24"
                            />
                            <div class="button-texts">
                                <b>
                                    {{
                                        'MODULES.MODULE-DETAIL.API-SERVERLESS'
                                            | translate
                                    }}
                                </b>
                                <span class="button-description-text">
                                    {{
                                        'MODULES.MODULE-DETAIL.OSCAR'
                                            | translate
                                    }}
                                </span>
                            </div>
                        </span>
                    </button>
                    <button
                        mat-menu-item
                        class="action-button sub-button"
                        routerLink="train"
                    >
                        <span class="button-with-icon">
                            <img
                                src="../../../../../assets/images/nomad-icon.svg"
                                width="24"
                                height="24"
                            />
                            <div class="button-texts">
                                <b>
                                    {{
                                        'MODULES.MODULE-DETAIL.API-PLATFORM'
                                            | translate
                                    }}</b
                                >
                                <span class="button-description-text">
                                    {{
                                        'MODULES.MODULE-DETAIL.NOMAD'
                                            | translate
                                    }}
                                </span>
                            </div>
                        </span>
                    </button>
                    <a
                        class="action-button sub-button"
                        mat-menu-item
                        target="_blank"
                        [href]="
                            'https://im.egi.eu/im-dashboard/configure?selected_tosca=simple-node-disk.yml&childs=ai4eoscvm.yaml&ai4eosc_model_image=' +
                            module.sources.docker_registry_repo
                        "
                    >
                        <span class="button-with-icon">
                            <img
                                src="../../../../../assets/images/im-logo.png"
                                width="24"
                                height="24"
                            />
                            <div class="button-texts">
                                <b>
                                    {{
                                        'MODULES.MODULE-DETAIL.API-CLOUD'
                                            | translate
                                    }}
                                </b>
                                <span class="button-description-text">
                                    {{ 'MODULES.MODULE-DETAIL.IM' | translate }}
                                </span>
                            </div>
                        </span>
                    </a>
                </mat-menu>

                <a
                    class="action-button"
                    [matMenuTriggerFor]="codespacesMenu"
                    mat-raised-button
                    color="accent"
                >
                    {{ 'MODULES.MODULE-DETAIL.CODESPACES' | translate }}
                    <mat-icon class="arrow-button">
                        keyboard_arrow_down
                    </mat-icon>
                </a>

                <mat-menu #codespacesMenu="matMenu" xPosition="before">
                    <button mat-menu-item (click)="trainModule('jupyter')">
                        <span class="button-with-icon">
                            <img
                                src="../../../../../assets/images/jupyter-logo.png"
                                width="24"
                                height="24"
                            />
                            <div class="button-texts">
                                <b>
                                    {{
                                        'MODULES.MODULE-DETAIL.DEVELOP'
                                            | translate
                                    }}</b
                                >
                                <span class="button-description-text">
                                    {{
                                        'MODULES.MODULE-DETAIL.JUPYTERLAB'
                                            | translate
                                    }}</span
                                >
                            </div>
                        </span>
                    </button>
                    <button
                        *ngIf="module.title === 'AI4OS Development Environment'"
                        mat-menu-item
                        (click)="trainModule('vscode')"
                    >
                        <span class="button-with-icon">
                            <img
                                src="../../../../../assets/images/vscode-logo.png"
                                width="24"
                                height="24"
                            />
                            <div class="button-texts">
                                <b>
                                    {{
                                        'MODULES.MODULE-DETAIL.DEVELOP'
                                            | translate
                                    }}</b
                                >
                                <span class="button-description-text">
                                    {{
                                        'MODULES.MODULE-DETAIL.VSCODE'
                                            | translate
                                    }}</span
                                >
                            </div>
                        </span>
                    </button>
                </mat-menu>
            </ng-container>
        </div>

        <div
            *ngIf="isTool && isLoggedIn() && isAuthorized()"
            [ngClass]="{
                'action-buttons-container-mobile': mobileQuery.matches,
                'action-buttons-container': !mobileQuery.matches
            }"
        >
            <a
                class="action-button"
                mat-raised-button
                color="accent"
                routerLink="train"
                id="deploy-tool-button"
            >
                {{ 'MODULES.MODULE-DETAIL.DEPLOY-MODULE' | translate }}
            </a>
        </div>
    </mat-card-header>

    <mat-divider></mat-divider>

    <mat-card-content>
        <div *ngIf="isLoading" class="spinner spinner-with-description">
            <mat-progress-spinner color="primary" mode="indeterminate">
            </mat-progress-spinner>
        </div>

        <div
            [ngClass]="{
                'grid-1-column': mobileQuery.matches,
                'grid-2-columns-content': !mobileQuery.matches
            }"
            *ngIf="!isLoading"
        >
            <markdown
                [data]="module.description"
                ngPreserveWhitespaces
                [disableSanitizer]="true"
                class="module-description"
            >
            </markdown>

            <div class="info-container">
                <div class="module-header-info">
                    <h4>
                        {{ 'MODULES.MODULE-DETAIL.BUILD-STATUS' | translate }}
                    </h4>
                    <p>
                        <a
                            href="{{
                                module.continuous_integration.build_status_url
                            }}"
                            ><img
                                alt="Build Status"
                                src="{{
                                    module.continuous_integration
                                        .build_status_badge
                                }}"
                        /></a>
                    </p>
                </div>

                <div class="module-header-info">
                    <h4>
                        {{ 'MODULES.MODULE-DETAIL.LICENSE' | translate }}
                    </h4>
                    <a
                        href="{{ module.sources.code }}/blob/-/LICENSE"
                        target="_blank"
                        >{{ module.license }}
                    </a>
                </div>
                <div class="module-header-info">
                    <h4>
                        {{ 'MODULES.MODULE-DETAIL.CREATED' | translate }}
                    </h4>
                    <p>{{ module.date_creation }}</p>
                </div>

                <h4>{{ 'MODULES.MODULE-DETAIL.CATEGORIES' | translate }}</h4>
                <div class="tags ml-3 mb-3">
                    <span
                        class="keyword"
                        *ngFor="let keyword of module.keywords"
                    >
                        {{ keyword }}
                    </span>
                </div>

                <h4>
                    {{
                        'MODULES.MODULE-DETAIL.ADDITIONAL-RESOURCES' | translate
                    }}
                </h4>

                <div class="grid-resources">
                    <a
                        class="action-button"
                        mat-raised-button
                        href="{{ module.sources.code }}"
                        target="_blank"
                    >
                        <span class="aligned-with-icon">
                            <img
                                src="../../../../../assets/images/github-mark.svg"
                                width="16"
                                height="16"
                            />
                            {{ 'GENERAL-BUTTONS.GITHUB' | translate }}
                        </span>
                    </a>

                    <a
                        class="action-button"
                        mat-raised-button
                        href="{{ module.sources.code }}/issues"
                        target="_blank"
                    >
                        <span class="aligned-with-icon">
                            <img
                                src="../../../../../assets/images/github-mark.svg"
                                width="16"
                                height="16"
                            />
                            {{ 'GENERAL-BUTTONS.REPORT-ISSUE' | translate }}
                        </span>
                    </a>

                    <a
                        class="action-button"
                        mat-raised-button
                        href="{{ module.dataset_url }}"
                    >
                        <span class="aligned-with-icon">
                            <img
                                src="../../../../../assets/images/database.png"
                                width="16"
                                height="16"
                            />
                            {{ 'MODULES.MODULE-DETAIL.DATASET' | translate }}
                        </span>
                    </a>

                    <a
                        class="action-button"
                        mat-raised-button
                        href="https://hub.docker.com/r/{{
                            module.sources.docker_registry_repo
                        }}"
                        target="_blank"
                    >
                        <span class="aligned-with-icon">
                            <img
                                src="../../../../../assets/images/dockerhub.png"
                                width="16"
                                height="16"
                            />
                            {{ 'GENERAL-BUTTONS.DOCKERHUB' | translate }}
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </mat-card-content>
</mat-card>
