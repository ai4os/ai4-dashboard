<mat-toolbar class="mb-3">
    <span class="aligned-with-icon">
        {{ 'DASHBOARD.TITLE' | translate }}
        <mat-icon>dashboard</mat-icon>
    </span>
</mat-toolbar>

<ng-template #loading>
    <div class="spinner">
        <mat-progress-spinner color="primary" mode="indeterminate">
        </mat-progress-spinner>
    </div>
</ng-template>

<ng-container *ngIf="!userStatsLoading && !clusterStatsLoading; else loading">
    <mat-tab-group class="main-tabs">
        <mat-tab label="Tab 1">
            <mat-toolbar class="mb-3">
                <span>
                    {{ 'DASHBOARD.USERS' | translate }}
                </span>
            </mat-toolbar>
            <app-stats-container
                [cpuNum]="this.cpuNumUserAgg + ' / ' + this.cpuNumNamespaceAgg"
                [cpuMhz]="this.cpuMHzUserAgg + ' / ' + this.cpuMHzNamespaceAgg"
                [memoryMB]="
                    this.memoryMBUserAgg + ' / ' + this.memoryMBNamespaceAgg
                "
                [diskMB]="this.diskMBUserAgg + ' / ' + this.diskMBNamespaceAgg"
                [gpuNum]="this.gpuNumUserAgg + ' / ' + this.gpuNumNamespaceAgg"
            ></app-stats-container>

            <mat-toolbar class="mb-3">
                <span>
                    {{ 'DASHBOARD.CLUSTER' | translate }}
                </span>
            </mat-toolbar>
            <app-stats-container
                [cpuNum]="
                    this.cpuNumClusterAgg + ' / ' + this.cpuNumClusterTotal
                "
                [memoryMB]="
                    this.memoryMBClusterAgg + ' / ' + this.memoryMBClusterTotal
                "
                [diskMB]="
                    this.diskMBClusterAgg + ' / ' + this.diskMBClusterTotal
                "
                [gpuNum]="
                    this.gpuNumClusterAgg + ' / ' + this.gpuNumClusterTotal
                "
            ></app-stats-container>

            <mat-tab label="Tab 2">
                <ng-template #loading>
                    <div class="spinner">
                        <mat-progress-spinner
                            color="primary"
                            mode="indeterminate"
                        >
                        </mat-progress-spinner>
                    </div>
                </ng-template>

                <mat-tab-group class="graphs-tab-group">
                    <mat-tab
                        label="{{
                            'DASHBOARD.STATS-VALUES.CPU-FREQ' | translate
                        }}"
                    >
                        <app-time-series-chart
                            id="cpuMhzDataChart"
                            [datesInput]="dates"
                            [dataInput]="cpuMhzData"
                            nameInput="cpuMhzData"
                            class="chartContainer"
                        ></app-time-series-chart
                    ></mat-tab>
                    <mat-tab
                        label="{{
                            'DASHBOARD.STATS-VALUES.CPU-NUM' | translate
                        }}"
                    >
                        <app-time-series-chart
                            id="cpuNumDataChart"
                            [datesInput]="dates"
                            [dataInput]="cpuNumData"
                            nameInput="cpuNumData"
                            class="chartContainer"
                        ></app-time-series-chart>
                    </mat-tab>
                    <mat-tab
                        label="{{ 'DASHBOARD.STATS-VALUES.RAM' | translate }}"
                    >
                        <app-time-series-chart
                            id="memoryMBDataChart"
                            [datesInput]="dates"
                            [dataInput]="memoryMBData"
                            nameInput="memoryMBData"
                            class="chartContainer"
                        ></app-time-series-chart>
                    </mat-tab>
                    <mat-tab
                        label="{{ 'DASHBOARD.STATS-VALUES.DISK' | translate }}"
                    >
                        <app-time-series-chart
                            id="diskMBDataChart"
                            [datesInput]="dates"
                            [dataInput]="diskMBData"
                            nameInput="diskMBData"
                            class="chartContainer"
                        ></app-time-series-chart>
                    </mat-tab>
                    <mat-tab
                        label="{{
                            'DASHBOARD.STATS-VALUES.GPU-NUM' | translate
                        }}"
                    >
                        <app-time-series-chart
                            id="gpuNumDataChart"
                            [datesInput]="dates"
                            [dataInput]="gpuNumData"
                            nameInput="gpuNumData"
                            class="chartContainer"
                        ></app-time-series-chart>
                    </mat-tab>
                    <mat-tab
                        label="{{
                            'DASHBOARD.STATS-VALUES.QUEUED-DATA' | translate
                        }}"
                    >
                        <app-time-series-chart
                            id="queuedDataChart"
                            [datesInput]="dates"
                            [dataInput]="queuedData"
                            nameInput="queuedData"
                            class="chartContainer"
                        ></app-time-series-chart>
                    </mat-tab>
                    <mat-tab
                        label="{{
                            'DASHBOARD.STATS-VALUES.RUNNING-DATA' | translate
                        }}"
                    >
                        <app-time-series-chart
                            id="runningDataChart"
                            [datesInput]="dates"
                            [dataInput]="runningData"
                            nameInput="runningData"
                            class="chartContainer"
                        ></app-time-series-chart>
                    </mat-tab>
                </mat-tab-group>

                <mat-toolbar class="mb-3">
                    <span>
                        {{ 'DASHBOARD.NODES' | translate }}
                    </span>
                </mat-toolbar>
                <mat-accordion>
                    <mat-expansion-panel *ngFor="let node of this.nodes">
                        <mat-expansion-panel-header>
                            <mat-panel-title class="id-title">
                                {{ node.name }}
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <app-stats-container
                            [cpuNum]="
                                node.cpu_used.toString() +
                                ' / ' +
                                node.cpu_total.toString()
                            "
                            [memoryMB]="
                                node.ram_used.toFixed(0).toString() +
                                ' / ' +
                                node.ram_total.toFixed(0).toString()
                            "
                            [diskMB]="
                                node.disk_used.toFixed(0).toString() +
                                ' / ' +
                                node.disk_total.toFixed(0).toString()
                            "
                            [gpuNum]="
                                node.gpu_used.toString() +
                                ' / ' +
                                node.gpu_total.toString()
                            "
                        ></app-stats-container>
                    </mat-expansion-panel>
                </mat-accordion>
            </mat-tab>
        </mat-tab>
    </mat-tab-group>
</ng-container>
